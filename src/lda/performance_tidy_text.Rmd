---
title: "Exploring Job Performance Scales"
description: "An examination of our collected job performance scales"
tags: ["R", "text analysis", "tidytext", "sentiment"]
weight: 2
draft: false
output: html_document
---

```{css, echo=FALSE}
/* this chunk of code centers all of the headings */
h1, h2, h3 {
  text-align: center;
}
```

```{r set-up, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(tidyverse)
library(tidytext)
library(stm)
library(ggplot2)
library(readr)
library(stringr)
library(reshape2)
library(wordcloud)
library(readxl)
library(gridExtra)
library(DT)

```

## Approach

Once we compiled potential scale items, we extracted the scales from the collection of papers on job performance. The following table displays the relevant scale items we have collected. Before we explored two different topic modeling approaches, we wanted to get a sense of the the content and sources of the scale items. In order to do this, we explored tidytext methods of text analysis, many of which come from [Text Mining with R](https://www.tidytextmining.com). 

```{r add-data, echo=FALSE, message=FALSE, warning=FALSE}

job_perf <- read_excel("/project/class/bii_sdad_dspg/uva/dod_ari2/DSPG-ARI2 -- Performance Item and Scale Database.xlsx",  sheet = "Performance Items")

soldier_effective <- job_perf %>%
  filter(CITATION == "Borman, W. C., Motowidlo, S. J., Rose, S. R., & Hanser, L. M. (1987). Development of a Model of Soldier Effectiveness: Retranslation Materials and Results. HUMAN RESOURCES RESEARCH ORGANIZATION ALEXANDRIA VA.")

job_perf <- job_perf %>%
  filter(CITATION != "Borman, W. C., Motowidlo, S. J., Rose, S. R., & Hanser, L. M. (1987). Development of a Model of Soldier Effectiveness: Retranslation Materials and Results. HUMAN RESOURCES RESEARCH ORGANIZATION ALEXANDRIA VA.")

#Grouping by scale source/citation if we want to consider texts as documents
cols <- c('STEM', 'ITEM')
job_perf$scale <- apply( job_perf[ , cols ], 1 , paste, collapse = " ")
job_perf$scale <- gsub("NA",' ', job_perf$scale)

job_perf <- job_perf %>%
  group_by(CITATION, SCALE_NAME, SOURCE_DOMAIN, YEAR) %>%
  summarise(scale = paste0(scale, collapse = " "))

job_perf$id <- c(1:63)

job_perf[, -c(5,6)] %>%
  datatable()
```

Our scales come from a range of years, but mainly come from the last thirty to forty years. Most of the scales come from academic sources, but there are also some from military and government sources. There were a number of industry or commericial sources which exist, but many were not availiable to us for the purpose of this analysis due to a paywall. 

```{r eda, echo=FALSE, message=FALSE, warning=FALSE}

job_perf %>%
  ggplot(aes(x = YEAR)) +
  geom_histogram(binwidth = 4, fill = "blue") +
  xlab("Year") +
  ylab("Number of Items") +
  ggtitle("Scale Years") -> scale_yr

job_perf %>%
  ggplot(aes(x = as.factor(SOURCE_DOMAIN), fill = as.factor(SOURCE_DOMAIN))) +
  geom_bar(show.legend = FALSE) +
  xlab("Scale Source Domains") +
  ylab("Number of Items") + 
  ggtitle("Source of Scales") +
  theme(axis.text.x = element_text(angle = 20)) -> scale_domains

grid.arrange(scale_yr, scale_domains, nrow = 1)

```

##Words in Scales

We also took a look at the most frequent words within the scales to verify that the scales that had been collected were, in fact, related to word and performance. These plots have the most common words which don't add content, stop words, removed. We see that job is, by far, the most frequent word within the scales, but we also see a number of other words which we would expect such as organization, supervisor, and performance. Feel being the second most common word tells us that many of the scales are likely asking about perceptions about the work environment. 

```{r tidy, echo=FALSE, message=FALSE, warning=FALSE}

tidy_perf <- tibble(id = job_perf$id, text = job_perf$scale)
data(stop_words)

tidy_perf <- tidy_perf %>%
  unnest_tokens(word, text) %>%
  anti_join(stop_words) %>%
  count(id, word, sort = TRUE)

tidy_perf %>%
  count(word, sort = TRUE) %>%
  filter(n > 30) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n, fill = word)) +
  geom_col(show.legend = FALSE) +
  xlab("Word") +
  ylab("Frequency") +
  coord_flip() +
  ggtitle("Highest Frequency Words in Job Performance Scales")
```

##Sentiment Analysis

We were also curious to see the sentiments contained within the job performance scales. That is, were the scales measuing respones to more negative questions and statement or more positive questions are statements. Within the dataset, using a standard sentiment dictionary, we determined that there were 449 negative words and 491 positive words, so in terms of positive and negative sentiment, they appear to be about equal. However, we can also look at a more nuanced division of sentiments. 

```{r sentiment-counts, message=FALSE, warning=FALSE, include=FALSE}

bingnegative <- get_sentiments("bing") %>%
  filter(sentiment == "negative")

bingpositive <- get_sentiments("bing") %>%
  filter(sentiment == "positive")

tidy_perf %>%
  semi_join(bingnegative) %>%
  summarize(negativewords = n())

tidy_perf %>%
  semi_join(bingpositive) %>%
  summarize(positiveword = n())
```

```{r sentiment-analysis, echo=FALSE, message=FALSE, warning=FALSE}
nrc_sent <- get_sentiments("nrc")

perf_sentiment <- tidy_perf %>%
  inner_join(nrc_sent) %>%
  count(word, sentiment, sort = TRUE) %>%
  ungroup()

tidy_perf %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment, sort = TRUE) %>%
  acast(word ~ sentiment, value.var = "n", fill = 0) %>%
  comparison.cloud(colors = c("#1b2a49", "#00909e"), 
                   max.words = 100)

perf_sentiment %>%
  filter(sentiment != "disgust") %>%
  group_by(sentiment) %>%
  top_n(10) %>%
  ungroup() %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n, fill = sentiment)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~sentiment, scales = "free_y", nrow = 3, ncol = 3) +
  labs(y = "Contribution to sentiment",
       x = NULL, 
       main = "Words Divided by Sentiment") +
  coord_flip()



```



Positive, trust, suprise, anticipation, and joy seem to have the most weight within these measures of sentiment. Although, we do notice that the sentiment dictionaries rate 'organization' as a positive word within suprise, trust, joy, anticipation, and positive. This may not be referring to the same 'organization' that our job performance scales are referring to. 

##Collected Scales and Existing Army Measurement

We did have one scale item which came from the Army, but it was very specific to the Army, specifically soldier, performance context with scale items such as, "While stationed in Germany, this soldier spent non-duty hours establishing a German-American Club to improve community relations" (Borman et al 1987). Although we did not include this item in our topic modeling, we were interested in the differences between this items and our collected scales. A comparison of the two words between the existing frameworks shows that the content is rather different between the two items. 

```{r scales-v-army, echo=FALSE, message=FALSE, warning=FALSE}

tidy_perf <- tibble(text = job_perf$scale)

tidy_perf <- tidy_perf %>%
  unnest_tokens(word, text) %>%
  anti_join(stop_words) %>%
  count(word, sort = TRUE)

tidy_soldier <- tibble(text = soldier_effective$ITEM)

tidy_soldier <- tidy_soldier %>%
  unnest_tokens(word, text) %>%
  anti_join(stop_words) %>%
  count(word, sort = TRUE)

joined <- full_join(tidy_perf, tidy_soldier, by = "word")

joined[is.na(joined)] <- 0
joined$total <- joined$n.x + joined$n.y
names(joined) <- c("word", "Scales", "Army", "total")

joined <- pivot_longer(joined, cols = c("Scales", "Army"))

#joined$total <- as.numeric(joined$total)
#joined$value <- as.numeric(joined$value)

joined %>%
  filter(total > 25) %>%
  ggplot(aes(x = reorder(word, total), y = value, fill = name)) + 
  geom_col() +
  xlab("Word") +
  ylab("Frequency") +
  scale_fill_discrete(name = "Source") +
  coord_flip() +
  ggtitle("Highest Frequency Words")

```

##Conclusion

As there are great differences between the job performance scales and the existing Army measurement, our decision not to include in our future topic modeling analysis seems correct for the moment. Our collected scales do seem to be connected to job performance and other facets of work satisfaction and relationships with organizations and supervisors. Keep exploring this website to see our topic model analysis. 
